---
sidebar_position: 1
---

# Introduction

## é¡¹ç›®ç¼˜èµ·

ç°åœ¨éƒ¨é—¨é¡¹ç›®ä¸»è¦ä½¿ç”¨ CRA æ„å»ºï¼Œä½†æ˜¯ CRA å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š

- CRA ä¸å…·å¤‡å®šåˆ¶åŒ–èƒ½åŠ›ï¼Œä¸åƒ Vue-cli å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™é€‰æ‹©éœ€è¦çš„ç‰¹æ€§ï¼Œå¯¼è‡´æ–°åˆ›å»ºçš„é¡¹ç›®éœ€è¦èŠ±å¤§é‡æ—¶é—´æ‰‹åŠ¨é…ç½®ã€‚è™½ç„¶ CRA å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å¤Ÿçµæ´»ï¼›
- CRA ä¸èƒ½åƒ Vue-cli ä¸€æ ·ä¼ å…¥è‡ªå®šä¹‰ Webpack é…ç½®ã€‚è™½ç„¶å¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹åº“è§£å†³ï¼Œä½†æ˜¯ç½‘ä¸Šèµ„æ–™æ¯”è¾ƒå°‘ï¼Œè€Œä¸”å¢åŠ å­¦ä¹ æˆæœ¬ï¼›

ç”±äºä»¥ä¸Šçš„åŸå› ï¼Œå¯¼è‡´åœ¨å¼€å‘æ–°é¡¹ç›®æ—¶ï¼Œå¾ˆå¤šåŒäº‹å®å¯ç›´æ¥å¤åˆ¶ä¸€ä»½å­˜é‡é¡¹ç›®ï¼Œä¹Ÿä¸æ„¿æ„ä»é›¶å¼€å§‹é…ç½®ã€‚æœ¬é¡¹ç›®æ—¨åœ¨å­¦ä¹ ç ”ç©¶ CRA æºç çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å¼€å‘ä¸€å¥—è„šæ‰‹æ¶æ„å»ºå·¥å…·ï¼Œè§£å†³ CRA å­˜åœ¨çš„é—®é¢˜ã€‚

é€šè¿‡ç ”ç©¶ CRA æºç å¯çŸ¥ï¼Œä¸€ä¸ªå‰ç«¯é¡¹ç›®å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š

- **é¡¹ç›®æ¨¡æ¿**ï¼šé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ä¸ä¸šåŠ¡å¼€å‘æœ‰äº¤é›†çš„éƒ¨åˆ†ï¼›
- **æ„å»ºè„šæœ¬**ï¼šé€šå¸¸å®‰è£…åœ¨ `node_modules` é‡Œé¢ï¼Œåªåœ¨æ„å»ºæ—¶å‘æŒ¥ä½œç”¨ï¼Œä¸€èˆ¬å¾ˆå°‘å»æ”¹åŠ¨ï¼›

å› æ­¤å¯ä»¥é€šè¿‡ monorepo æœºåˆ¶ç®¡ç†å¤šä¸ªåŒ…ï¼Œä¾‹å¦‚ï¼š

```js
// é¡¹ç›®æ¨¡æ¿
react-template
react-ts-template
vue-template
vue-ts-template

// npm åŒ…æ¨¡æ¿
npm-package

// æ„å»ºè„šæœ¬
garfield-script

// é¡¹ç›®é…ç½®
garfield-redux
garfield-router
eslint-config
prettier-config
stylelint-config
postcss-config
purgecss-config
commit-lint
```

å¦‚æœä½¿ç”¨è‡ªå®šä¹‰çš„è„šæ‰‹æ¶å·¥å…·ï¼Œä¸ä»…å¯ä»¥æ”¯æŒè‡ªå®šä¹‰ Webpack é…ç½®ï¼Œè¿˜å¯ä»¥å¢åŠ ä¸åŒçš„é¡¹ç›®æ¨¡æ¿ï¼ŒåŒæ—¶æ”¯æŒ React å’Œ Vue é¡¹ç›®ï¼Œå‚è€ƒä¸‹å°¤å¤§çš„ `create-vite`ï¼š

```js
const templateDir = path.join(__dirname, `template-${template}`)

const write = (file, content) => {
  const targetPath = renameFiles[file]
    ? path.join(root, renameFiles[file])
    : path.join(root, file)
  if (content) {
    fs.writeFileSync(targetPath, content)
  } else {
    copy(path.join(templateDir, file), targetPath)
  }
}

const files = fs.readdirSync(templateDir)
for (const file of files.filter((f) => f !== 'package.json')) {
  write(file)
}
```

æ³¨æ„è¿™é‡Œæœ‰ä¸¤ä¸ªæ–‡ä»¶è¦å¤„ç†ä¸‹ï¼Œä¸€ä¸ªæ˜¯ç»™ `package.json` ä¿®æ”¹åŒ…åï¼š

```js
const pkg = require(path.join(templateDir, `package.json`))

pkg.name = packageName || targetDir

write('package.json', JSON.stringify(pkg, null, 2))
```

è¿˜æœ‰æ˜¯ `.gitignore` ä¿®æ”¹æ–‡ä»¶åï¼š

```js
const renameFiles = {
  _gitignore: '.gitignore'
}
```

> https://github.com/vitejs/vite/blob/main/packages/create-vite/index.js

æ­¤å¤–è¿˜æä¾›å¼€ç®±å³ç”¨çš„é…ç½®ï¼Œä¾‹å¦‚ React çŠ¶æ€ç®¡ç†åº“ä¸ä»…é…ç½®éº»çƒ¦ï¼Œä½¿ç”¨ä¹Ÿå¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥å¹²è„†å°è£…æˆäº†ä¸€ä¸ªä¾èµ–åº“ï¼Œæ”¯æŒçƒ­æ’æ‹”ï¼Œä¸€ä¸ªå‘½ä»¤å³å¯ä¸ºé¡¹ç›®èµ‹èƒ½ã€‚

## é¡¹ç›®ç‰¹ç‚¹

- ä½¿ç”¨å•ä»“å¤šåŒ…ï¼ˆmonorepoï¼‰ï¼Œæ”¯æŒçƒ­æ’æ‹”ï¼Œä¸€ä¸ªå‘½ä»¤å³å¯ä¸ºé¡¹ç›®èµ‹èƒ½ï¼›
- ä½¿ç”¨ pre-script è¿›è¡Œå‰ç½®æ“ä½œï¼Œä¾‹å¦‚æ£€æŸ¥ç‰ˆæœ¬ã€æ‰“å°æ¬¢è¿ä¿¡æ¯ï¼›
- å› ä¸ºæ˜¯æ„å»ºå·¥å…·ï¼Œæ‰€ä»¥åªç”¨ä¸€ä»½ `webpack.config.js` ï¼Œå…·ä½“å‚è€ƒ CRA é…ç½®ï¼›
- å‚è€ƒ Vue-cli åšæ³•ï¼Œä½¿ç”¨ `chain-webpack` çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼›
- ä½¿ç”¨ CRA ä¸­çš„å·¥å…·å‡½æ•°ï¼Œä¾‹å¦‚è·å–å·¥ä½œç›®å½•ã€æ¸…ç©ºæ§åˆ¶å°ç­‰ç­‰ï¼›
- å‚è€ƒ Vue-cli åšæ³•ï¼Œå…è®¸æä¾›è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä¸é»˜è®¤é…ç½®æ–‡ä»¶åˆå¹¶ï¼›

## æŠ€æœ¯ç»†èŠ‚

ä½¿ç”¨ Webpack5 ï¼Œå¼€å‘æœåŠ¡å™¨ä½¿ç”¨ `express` + `webpack-dev-middleware`

:::tip

Webpack é…ç½®æœ€ä½³å®è·µï¼Œé™¤äº† Vue-cli å’Œ CRA æºç ï¼Œè¿˜å¯ä»¥å‚è€ƒ `next.js` æºç ï¼š

https://github.com/vercel/next.js/blob/canary/packages/next/build/webpack-config.ts

:::

ç°åœ¨å®ç°å•ä»“å¤šåŒ…æ–¹æ¡ˆä¸»è¦æœ‰ï¼š

- lerna + yarn workspace ï¼›
- pnpm ï¼›

:::tip

å…¶ä¸­ï¼š

- lerna å·²ç»åœæ­¢ç»´æŠ¤ï¼›
- pnpm è‡ªå¸¦å•ä»“å¤šåŒ…åŠŸèƒ½ï¼Œä¸ä¼šå‡ºç°ä¾èµ–é‡å¤å®‰è£…é—®é¢˜ï¼Œè€Œä¸”è§£å†³äº†å¹½çµä¾èµ–é—®é¢˜ï¼ŒVue3 å’Œ Vite éƒ½åœ¨ä½¿ç”¨ï¼›

:::

ä½¿ç”¨ pnpm ä½œä¸ºåŒ…ç®¡ç†å·¥å…·

åŸºæœ¬ç”¨æ³•ï¼š

- `pnpm add <pkg>`ï¼šå®‰è£…ä¾èµ–
- `pnpm add -D <pkg>`ï¼šå®‰è£…ä¾èµ–åˆ° devDependencies
- `pnpm install`ï¼šå®‰è£…æ‰€æœ‰ä¾èµ–
- `pnpm -r update`ï¼šé€’å½’æ›´æ–°æ¯ä¸ªåŒ…çš„ä¾èµ–
- `pnpm -r update typescript@latest`ï¼šå°†æ¯ä¸ªåŒ…çš„ typescript æ›´æ–°ä¸ºæœ€æ–°ç‰ˆæœ¬
- `pnpm remove`ï¼šç§»é™¤ä¾èµ–

å¦‚ä½•æ”¯æŒ monorepo é¡¹ç›®ï¼šhttps://pnpm.io/zh/workspaces

`pnpm -r` å¸¦ä¸€ä¸ªå‚æ•° `-r` è¡¨ç¤ºè¿›è¡Œé€’å½’æ“ä½œã€‚

[pnpm å®˜æ–¹æ–‡æ¡£](https://pnpm.io/zh/)

[ä¸ºä»€ä¹ˆ vue æºç ä»¥åŠç”Ÿæ€ä»“åº“è¦è¿ç§» pnpm?](https://juejin.cn/post/7038192011882528776)

ä½¿ç”¨ npm ç§æœ

ä½¿ç”¨æ„å»ºå‘å¸ƒè„šæœ¬ï¼Œé€šè¿‡ `npm run release` å‘å¸ƒ npm åŒ…ï¼š

- ä½¿ç”¨ `semver` è·å–ç‰ˆæœ¬å·ï¼›
- è·‘ä¸€éæµ‹è¯•æµç¨‹ï¼›
- æ‰§è¡Œæ„å»ºå‘½ä»¤ï¼Œå°†æ„å»ºäº§ç‰©è¾“å‡ºåˆ° `./dist` ç›®å½•ï¼›
- ä¿®æ”¹ `package.json` ç‰ˆæœ¬å·ï¼›
- ç”Ÿæˆ changelog ï¼›
- git æäº¤æºç å¹¶ç”Ÿæˆ tagï¼ˆæäº¤æ—¶é€šè¿‡ husky æ ¡éªŒï¼‰ï¼›
- å°† `package.json` å’Œ `README.md` å¤åˆ¶åˆ° `./dist` ç›®å½•ï¼›
- æœ€åæ‰§è¡Œ `npm publish` å‘å¸ƒï¼›

:::tip

å‚è€ƒï¼š

[petite-vue/scripts/release.js](https://github.com/vuejs/petite-vue/blob/main/scripts/release.js)

[æ‰‹æŠŠæ‰‹æ•™ä½ ä½¿ç”¨Rollupæ‰“åŒ…ğŸ“¦å¹¶å‘å¸ƒè‡ªå·±çš„å·¥å…·åº“ğŸ”§](https://juejin.cn/post/6902659492161421325)

[å¤§å‚æ˜¯å¦‚ä½•ç”¨DevCloudæµæ°´çº¿å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²Webåº”ç”¨çš„ï¼Ÿ](https://juejin.cn/post/6887961766170066951)

:::

ä½¿ç”¨ `open` æ¨¡å—åœ¨ç¼–è¯‘å®Œæˆåè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼š

- ä½¿ç”¨ webpack-dev-server çš„ `devServer.open = true` åœ¨å¯åŠ¨å¼€å‘æœåŠ¡å™¨çš„æ—¶å€™å°±æ‰“å¼€æµè§ˆå™¨ï¼Œä½†æ˜¯æ­¤æ—¶ç¼–è¯‘è¿˜æ²¡å®Œæˆï¼Œæ‰€ä»¥è¯·æ±‚ä¸€ç›´æŒ‚ç€ï¼Œæµè§ˆå™¨æ ‡ç­¾é¡µä¸€ç›´è½¬åœˆåœˆï¼Œåªæœ‰ç¼–è¯‘å®Œæˆåæ‰æ‰“å¼€é¡µé¢ï¼Œä½“éªŒæ¯”è¾ƒå·®ï¼›
- ä½¿ç”¨ Vue-cli ä¼šå…ˆè¿›è¡Œç¼–è¯‘ï¼Œæ§åˆ¶å°ä¼šæ‰“å°ç¼–è¯‘è¿›åº¦ï¼Œç¼–è¯‘å®Œæˆåå†æ‰“å¼€æµè§ˆå™¨ï¼Œç”¨æˆ·ä½“éªŒè¾ƒå¥½ï¼›

:::tip

å‚è€ƒï¼š

[npm ä¹‹ç‹å¼€å‘çš„ç¥å™¨ open èƒ½åœ¨å¯åŠ¨æœåŠ¡æ—¶è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œ100è¡Œæºç æ­ç§˜ï¼](https://juejin.cn/post/7026505183819464734)

[open - npm](https://www.npmjs.com/package/open)

:::

ä½¿ç”¨å•å…ƒæµ‹è¯•ï¼š

:::tip

å‚è€ƒï¼š

[é‚£äº›å¹´é”™è¿‡çš„Reactç»„ä»¶å•å…ƒæµ‹è¯•ï¼ˆä¸Šï¼‰](https://juejin.cn/post/6943430853972852750)

[é‚£äº›å¹´é”™è¿‡çš„Reactç»„ä»¶å•å…ƒæµ‹è¯•ï¼ˆä¸‹ï¼‰](https://juejin.cn/post/6946008649026240519)

:::
